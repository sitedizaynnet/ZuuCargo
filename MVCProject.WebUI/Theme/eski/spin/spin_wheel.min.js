var intervalVariable,rotationDegree=0,startSpinTime=0,startTime=0,endSpinTime=0,wheelcurrentRotation=0,currentRotation=0,Code="",result="";function SpinWheelPopupCreateCookie(e,t,n){var o;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),o="; expires="+i.toGMTString()}else o="";document.cookie=e+"="+t+o+"; path=/"}function SpinWheelPopupGetCookie(e){return document.cookie.length>0&&(c_start=document.cookie.indexOf(e+"="),-1!=c_start)?(c_start=c_start+e.length+1,c_end=document.cookie.indexOf(";",c_start),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):0}function valideteForm(){$(".text-danger").remove();var e=$("#ocmp_spin_wheel input[name='firstname']").val(),t=$("#ocmp_spin_wheel input[name='lastname']").val(),n=$("#ocmp_spin_wheel input[name='email']").val(),o=!1;if((e.length<3||e.length>32)&&($("#ocmp_spin_wheel input[name='firstname']").after('<div class="text-danger">'+errors.firstname+"</div>"),o=!0),(t.length<3||t.length>32)&&($("#ocmp_spin_wheel input[name='lastname']").after('<div class="text-danger">'+errors.lastname+"</div>"),o=!0),n.length<3?($("#ocmp_spin_wheel input[name='email']").after('<div class="text-danger">'+errors.email_empty+"</div>"),o=!0):validateEmail(n)||($("#ocmp_spin_wheel input[name='email']").after('<div class="text-danger">'+errors.email_invalid+"</div>"),o=!0),1==o)return!1;onRotatePopup(e,t,n)}function validateEmail(e){return/^([\w-\.]+@([\w-]+\.)+[\w-]{2,4})?$/.test(e)}function onRotatePopup(e,t,n){var o=$("#ocmp_spin_wheel input[type='text']");$.ajax({url:onRotateURL,type:"POST",data:o,dataType:"json",beforeSend:function(){$("#btn-spin-wheel").button("loading")},success:function(o){if(o.error_email_exist&&$("#ocmp_spin_wheel input[name='email']").after('<div class="text-danger">'+errors.email_exist+"</div>"),o.success){Code=o.code;var i=o.offer_no;rotateWheel(parseInt(720+30*(i-1)),9999),result=o.result;var a='<div class="ocmp-title">'+o.result_title+"</div>";a+='<div class="ocmp-sub-title">'+o.result_description+"</div>","win"==o.result&&(a+='<div class="codeShow"><span class="copy_msg"></span><input id="coupon-code" value="" style="display:none;" /></div>'),a+='<button class="btn btn-block btn-color" id="btn-continue">'+btn_continue+"</button>",$("#ocmp_spin_wheel .success-description").html(a),console.log(o.code),1!=display_coupon&&""!=o.code&&$.ajax({url:emailSend,type:"post",data:{sendEmail:!0,email:n,firstname:e,lastname:t,code:Code,offer_no:i},dataType:"json",success:function(e){}})}},complete:function(){$("#btn-spin-wheel").button("reset")}})}function CopyToClipboard(e){var t,n,o="INPUT"===e.tagName||"TEXTAREA"===e.tagName;if(o)i=e,t=e.selectionStart,n=e.selectionEnd;else{if(!(i=document.getElementById("_hiddenCopyText_"))){var i=document.createElement("textarea");i.style.position="absolute",i.style.left="-9999px",i.style.top="0",i.id="_hiddenCopyText_",document.body.appendChild(i)}i.textContent=e.textContent}var a,s=document.activeElement;i.focus(),i.setSelectionRange(0,i.value.length);try{a=document.execCommand("copy")}catch(e){a=!1}return s&&"function"==typeof s.focus&&s.focus(),o?e.setSelectionRange(t,n):i.textContent="",a}function rotateWheel(e,t){"1"==sound_status&&setTimeout(function(){new Audio("catalog/view/javascript/jquery/ocmp_spin_wheel/spin_sound.mp3").play()},600),currentRotation=0,rotationDegree=e,startSpinTime=0,endSpinTime=t,startTime=0,animationFrame(Rotate)}function animationFrame(e){window.requestAnimationFrame?window.requestAnimationFrame(e):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(e):window.mozRequestAnimationFrame?window.mozRequestAnimationFrame(e):Console.log("Sorry! No Supported Browser")}function wheelRotation(e){return 1-Math.pow(1-e,5)}function Rotate(e){startTime||(startTime=e),(startSpinTime=e-startTime)>endSpinTime&&(startSpinTime=endSpinTime),wheelcurrentRotation=wheelRotation(rotationDegree/endSpinTime*startSpinTime/rotationDegree),currentRotation=wheelcurrentRotation*rotationDegree,wheelcurrentRotation<1&&($(".ocmp_spinner").css({transform:"rotate3d(0,0,1,"+currentRotation+"deg)","-webkit-transform":"rotate3d(0,0,1,"+currentRotation+"deg)"}),animationFrame(Rotate)),wheelcurrentRotation>.999&&($(".spin-description").hide(),$(".success-description").show(),$(".spin-form").hide(),2==display_coupon?($("#coupon-code").val(send_mail),$("#coupon-code").show()):""!=Code&&($("#coupon-code").val(Code),$("#coupon-code").show(),"1"==fireworks_status&&$(".ocmp_spin_content").fireworks()))}function hexToRgb(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,n,o){return t+t+n+n+o+o});var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function rgb2hsb(e,t,n){e/=255,t/=255,n/=255;var o,i,a,s=Math.min(e,t,n),c=Math.max(e,t,n),p=c-s,r={hue:0,sat:0,bri:c};return 0!==p&&(r.sat=p/c,o=((c-e)/6+p/2)/p,i=((c-t)/6+p/2)/p,a=((c-n)/6+p/2)/p,e===c?r.hue=a-i:t===c?r.hue=1/3+o-a:n===c&&(r.hue=2/3+i-o),r.hue<0&&(r.hue+=1),r.hue>1&&(r.hue-=1)),r.hue*=360,r.sat*=100,r.bri*=100,r}$(document).ready(function(){$("body").append('<div id="close-icon"><i class="fa fa-gift fa-3xs"></i></div>');var e=hexToRgb(ocmp_wheel_color),t=rgb2hsb(e.r,e.g,e.b),n="hue-rotate("+t.hue+"deg) saturate("+t.sat+"%) contrast(1.1)";if($(".ocmp_spinner").css({filter:n}),""!=when_to_display){var o=SpinWheelPopupGetCookie("LoadSpinPopup");$("#close-icon").hide(),1==when_to_display?0==o?($("#ocmp_spin_wheel > div").show(),setTimeout(function(){$(".ocmp_spin_content").addClass("ShowSpinContent")},500)):($(".ocmp_spin_content").removeClass("ShowSpinContent"),setTimeout(function(){$("#ocmp_spin_wheel > div").hide()},500),1==close_icon&&$("#close-icon").show()):2==when_to_display?0==o&&setTimeout(function(){$("#ocmp_spin_wheel > div").show(),setTimeout(function(){$(".ocmp_spin_content").addClass("ShowSpinContent")},500)},1e3*spin_display_popup):3==when_to_display&&$(document).on("scroll",function(){if(!window.displayed_through_scroll){var e=$(window).height(),t=$(document).height();$(window).scrollTop()/(t-e)*100>=spin_scroll_popup&&0==o&&($("#ocmp_spin_wheel > div").show(),setTimeout(function(){$(".ocmp_spin_content").addClass("ShowSpinContent")},500))}})}if($(document).on("click","#btn-spin-wheel",function(){valideteForm()}),$("#close-icon").on("click",function(){$("#ocmp_spin_wheel > div").show(),setTimeout(function(){$(".ocmp_spin_content").addClass("ShowSpinContent"),$("#close-icon").hide()},500)}),$(".close_popup").on("click",function(){SpinWheelPopupCreateCookie("LoadSpinPopup",1,display_interval),$(".ocmp_spin_content").removeClass("ShowSpinContent"),setTimeout(function(){$("#ocmp_spin_wheel > div").hide()},500),1==close_icon?$("#close-icon").show():$("#close-icon").hide()}),$(document).on("click","#btn-continue",function(){SpinWheelPopupCreateCookie("LoadSpinPopup",1,display_interval),1!=display_coupon&&1==result&&(CopyToClipboard(document.getElementById("coupon-code")),$(".copy_msg").html(copy_msg).show()),setTimeout(function(){$(".ocmp_spin_content").removeClass("ShowSpinContent"),setTimeout(function(){$("#ocmp_spin_wheel > div").hide()},500)},2e3)}),""!=disable_popup&&"0"!=disable_popup){o=SpinWheelPopupGetCookie("LoadSpinPopup");SpinWheelPopupCreateCookie("LoadSpinPopup",1,display_interval),setTimeout(function(){$(".ocmp_spin_content").removeClass("ShowSpinContent"),setTimeout(function(){$("#ocmp_spin_wheel > div").hide()},500)},1e3*disable_popup),"1"==close_icon&&$("#close-icon").show()}});